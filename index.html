<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>San Mateo Lunch Menu</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: url('https://resources.finalsite.net/images/f_auto,q_auto,t_image_size_6/v1759362350/nuevaschoolorg/rloo1fjmir6wnpiozyh4/TestBG3.jpg') no-repeat center center fixed;
      background-size: cover;
      margin: 0;
      width: 1920px;
      height: 1080px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      color: #000;
    }

    .content { margin-top: 150px; }
    header {
      text-align: center;
      font-size: 52px;
      font-weight: bold;
      margin: 0 0 40px 0;
    }

    .menu {
      display: flex;
      justify-content: space-evenly;
      align-items: flex-start;
      padding: 0 200px;
      font-size: 30px;
      line-height: 1.3;
    }

    .column { width: 45%; }
    h3 { margin: 18px 0 8px 0; }

    .omnivore { color: #000; font-weight: bold; }
    .vegetarian { color: green; font-weight: bold; }
    .vegan { color: purple; font-weight: bold; }
    .sandwich { color: #0077ff; font-weight: bold; }
    .salad { color: #008080; font-weight: bold; }
    .soup { color: orange; font-weight: bold; }

    footer {
      text-align: center;
      font-size: 22px;
      margin-bottom: 20px;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="content" id="menuContent">
    <header id="menuHeader">Loading menu...</header>
    <div class="menu" id="menu"></div>
  </div>
  <footer>Menu display is based on the web PDF and is subject to change.</footer>

<script>
  const menuUrl = 'https://raw.githubusercontent.com/hnall/US-lunch/main/sm_menu.json';
  const fallbackImage = 'https://resources.finalsite.net/images/f_auto,q_auto,t_image_size_6/v1759264059/nuevaschoolorg/xsbsbt1z8yeiuvpcoemz/US_REDIRECT_IMG.jpg';

  async function loadMenu() {
    try {
      const res = await fetch(menuUrl, { cache: 'no-store' });
      if (!res.ok) throw new Error('HTTP ' + res.status);
      const data = await res.json();

      const now = new Date(new Date().toLocaleString('en-US', { timeZone: 'America/Los_Angeles' }));
      let targetDate = new Date(now);

      // After 1 PM ‚Üí show tomorrow‚Äôs menu
      if (now.getHours() >= 13) {
        targetDate.setDate(now.getDate() + 1);
        console.info('‚è© After 1PM ‚Äì showing tomorrow‚Äôs menu');
      } else {
        console.info('üïê Before 1PM ‚Äì showing today‚Äôs menu');
      }

      // FIX: use local date string instead of UTC ISO
      const dateKey = targetDate.toLocaleDateString('en-CA', { timeZone: 'America/Los_Angeles' });
      console.info(`üìÖ Looking for date key: ${dateKey}`);
      const menuData = data[dateKey];

      if (!menuData) {
        console.warn(`‚ö†Ô∏è No menu found for ${dateKey}. Redirecting to fallback image.`);
        window.location.href = fallbackImage;
        return;
      }

      const header = document.getElementById('menuHeader');
      const menuContainer = document.getElementById('menu');
      menuContainer.innerHTML = '';

      const options = { weekday: 'short', month: 'short', day: 'numeric' };
      header.textContent = `San Mateo Lunch Menu ‚Äì ${targetDate.toLocaleDateString('en-US', options)}`;

      const leftCol = document.createElement('div');
      leftCol.classList.add('column');
      const rightCol = document.createElement('div');
      rightCol.classList.add('column');

      const leftKeys = ['omnivore', 'vegetarian', 'vegan'];
      const rightKeys = ['sandwich', 'salad', 'soup'];

      for (const key of leftKeys) {
        const section = menuData[key];
        if (section) {
          const h3 = document.createElement('h3');
          h3.textContent = key === 'omnivore'
            ? section.title
            : `${section.title} (${key.charAt(0).toUpperCase() + key.slice(1)})`;
          h3.className = key;
          leftCol.appendChild(h3);

          const p = document.createElement('p');
          p.textContent = section.items.join(', ');
          leftCol.appendChild(p);
        }
      }

      for (const key of rightKeys) {
        const section = menuData[key];
        if (section) {
          const h3 = document.createElement('h3');
          h3.textContent = section.title;
          h3.className = key;
          rightCol.appendChild(h3);

          const p = document.createElement('p');
          p.textContent = section.items.join(', ');
          rightCol.appendChild(p);
        }
      }

      menuContainer.appendChild(leftCol);
      menuContainer.appendChild(rightCol);
      console.info(`‚úÖ Menu loaded for ${dateKey}`);
    } catch (err) {
      console.error('‚ùå Fetch or render failed', err);
      window.location.href = fallbackImage;
    }
  }

  loadMenu();
</script>

</body>
</html>

