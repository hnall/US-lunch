<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lunch Menu</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: url('https://resources.finalsite.net/images/f_auto,q_auto,t_image_size_6/v1759362350/nuevaschoolorg/rloo1fjmir6wnpiozyh4/TestBG3.jpg') no-repeat center center fixed;
      background-size: cover;
      margin: 0;
      width: 1920px;
      height: 1080px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      color: #000;
    }

    .content {
      margin-top: 150px; /* shift header + menu down together */
    }

    header {
      text-align: center;
      font-size: 52px;
      font-weight: bold;
      margin: 0 0 40px 0;
    }

    .menu {
      display: flex;
      justify-content: space-evenly;
      align-items: flex-start;
      padding: 0 200px;
      font-size: 30px;
      line-height: 1.3;
    }

    .column {
      width: 45%;
    }

    h3 {
      margin: 18px 0 8px 0;
    }

    .omnivore { color: #000; font-weight: bold; }
    .vegetarian { color: green; font-weight: bold; }
    .vegan { color: purple; font-weight: bold; }
    .sandwich { color: #0077ff; font-weight: bold; }
    .salad { color: #008080; font-weight: bold; }
    .soup { color: orange; font-weight: bold; }

    footer {
      text-align: center;
      font-size: 22px;
      margin-bottom: 20px;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="content">
    <header id="header">Loading menu...</header>

    <div class="menu" id="menu" style="display:none;">
      <div class="column" id="col1"></div>
      <div class="column" id="col2"></div>
    </div>
  </div>

  <footer>Menu display is based on the web PDF and is subject to change.</footer>

  <script>
    const JSON_URL = "https://github.com/hnall/US-lunch/blob/main/sm_menu.json";
    const REDIRECT_IMAGE_URL = "https://resources.finalsite.net/images/f_auto,q_auto,t_image_size_6/v1759264059/nuevaschoolorg/xsbsbt1z8yeiuvpcoemz/US_REDIRECT_IMG.jpg";

    // Get today’s ISO date in Pacific time
    function todayISO() {
      const la = new Date(new Date().toLocaleString('en-US', { timeZone: 'America/Los_Angeles' }));
      return la.toISOString().split('T')[0];
    }

    function formatDateForHeader() {
      const la = new Date(new Date().toLocaleString('en-US', { timeZone: 'America/Los_Angeles' }));
      return la.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
    }

    async function init() {
      const today = todayISO();
      let data;
      try {
        const res = await fetch(JSON_URL, { cache: "no-store" });
        if (!res.ok) throw new Error("Bad response");
        data = await res.json();
      } catch (err) {
        console.error("JSON fetch failed:", err);
        window.location.href = REDIRECT_IMAGE_URL;
        return;
      }

      const menuData = data[today];
      if (!menuData) {
        window.location.href = REDIRECT_IMAGE_URL;
        return;
      }

      // Update header
      document.getElementById("header").textContent = `San Mateo Lunch Menu – ${formatDateForHeader()}`;

      const col1 = document.getElementById("col1");
      const col2 = document.getElementById("col2");

      col1.innerHTML = `
        <h3 class="omnivore">${menuData.omnivore?.title || "Kitchen Table"}</h3>
        <p>${menuData.omnivore?.menu || ""}</p>

        <h3 class="vegetarian">Earthly Selections (Vegetarian)</h3>
        <p>${menuData.vegetarian?.menu || ""}</p>

        <h3 class="vegan">Plant Inspired (Vegan)</h3>
        <p>${menuData.vegan?.menu || ""}</p>
      `;

      col2.innerHTML = `
        <h3 class="sandwich">Sandwich Favorite</h3>
        <p>${menuData.sandwich?.menu || ""}</p>

        <h3 class="salad">Superfood Tossed (Salad)</h3>
        <p>${menuData.salad?.menu || ""}</p>

        ${menuData.soup?.menu ? `<h3 class="soup">Soup</h3><p>${menuData.soup.menu}</p>` : ""}
      `;

      document.getElementById("menu").style.display = "flex";
    }

    init();
  </script>
</body>
</html>
